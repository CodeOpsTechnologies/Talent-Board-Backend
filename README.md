# TalentBoard Backend

[![GitHub license](https://img.shields.io/github/license/Naereen/StrapDown.js.svg)](https://github.com/CodeOpsTechnologies)

This is a community initiative to connect active job seekers with organizations and people who participate in employee referral programs.

Currently, we encourage only job seekers / candidates who lost their jobs in the pandemic scenario. Referrals should be verified via LinkedIn profiles. (Click LinkedIn Connect-> Save profile as PDF-> Refer). As a community, it will be a win-win situation for all of us if we can support and make the future safe for one another. Help them to resume their career by referring. #refer2resume

## Architecture

![TalentBoard Architecture](https://user-images.githubusercontent.com/23396903/120200797-597e1f80-c242-11eb-9cc7-2c47126f088b.PNG)

## Prerequisites
- [Node.js](https://nodejs.org/en/download/) & [NPM](https://www.npmjs.com/get-npm) 
- [Serverless framework](https://www.npmjs.com/package/serverless)
- [AWS Account](https://portal.aws.amazon.com/billing/signup#/start)

## Tech stack
- AWS Cloud
- NodeJS as the programming language

## AWS Services Consumed
- [AWS Lambda](https://aws.amazon.com/lambda/) for compute
- [Amazon API Gateway](https://aws.amazon.com/api-gateway/) to create REST APIs
- [Amazon Aurora Serverless](https://aws.amazon.com/rds/aurora/serverless/) with MySQL 5.7 engine as the database
- [Amazon CloudWatch](https://aws.amazon.com/cloudwatch/) for application monitoring and scheduled cron
- [Data API](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/data-api.html) for Aurora Serverless to connect to the RDS Cluster

## Serverless Framework Plugins Used
1.  [serverless-pseudo-parameters](https://www.npmjs.com/package/serverless-pseudo-parameters) to use CloudFormation Pseudo Parameters
2.  [serverless-dotenv-plugin](https://www.npmjs.com/package/serverless-dotenv-plugin) to preload environment variables into serverless
3.  [serverless-offline](https://www.npmjs.com/package/serverless-offline)

## Folder Structure
```bash
.
├── __tests__        # Automated tests and test utils using JEST framework
├── ApiDocs          # Autogenerated Documentation files
├── Docs             # API Documentation source files
├── Locations        # Locations module source files to get countries, states and cities
├── Resources        # Database and Lambda configuration files (essentially serverless templates which will deploy all resources)
├── SampleRequests   # Sample request JSON files to test lambda functions locally
├── TalentBoard      # Source files for all talent board APIs 
├── TalentBoardCron  # Source files for cron job to expire user profiles based on their retention period provided
├── Utils            # Utilities such as constants, reusable functions, database connection
├── LICENSE
└── README.md
```

## Getting Started
[![GitHub code size in bytes](https://img.shields.io/github/languages/code-size/CodeOpsTechnologies/talent-board-be?logo=github)](https://talent.awsug.in/) 
[![GitHub commit activity](https://img.shields.io/github/commit-activity/m/CodeOpsTechnologies/talent-board-be?color=bluevoilet&logo=github)](https://github.com/CodeOpsTechnologies/talent-board-be/commits/) 
[![GitHub repo size](https://img.shields.io/github/repo-size/CodeOpsTechnologies/talent-board-be?logo=github)](https://talent.awsug.in/)

**1.** Fork this repository and clone into your local machine.
```bash
git clone https://github.com/CodeOpsTechnologies/talent-board-be.git
```
**2.** Navigate to the local project directory.
```bash
cd talent-board-be
```
**3.** Install all associated npm dependencies.
```bash
npm install
```
**4.** You'll need to navigate into *[/Resources/DatabaseResources](https://github.com/CodeOpsTechnologies/talent-board-be/tree/main/Resources/DatabaseResources)* and run the following command to deploy the Aurora Serverless database:
```bash
cd Resources/DatabaseResources/
# Provision database resources (VPC, Subnets, RDS Cluster, etc.)
serverless deploy
```
The above command will deploy the following resources:
1.  Aurora Serverless RDS Cluster
2.  Aurora Serverless cluster parameter group
3.  Secrets manager to store the DB credentials
4.  Public route table
5.  Three subnets
6.  VPC network
7.  Security group

The above command will output the following details:
1.  `SecretARN` - The Secrets Manager's ARN
2.  `ClusterName` - The Aurora RDS cluster's name
3.  `DBName` - The name of the database created

**5.** Navigate to the root of your project directory and run the following command to deploy the REST APIs and corresponding Lambda functions:
```bash
cd ..
# Provision the required API Gateway endpoints & Lambda functions
serverless deploy
```

After performing all the above steps, the DB, API and Lambda function resources would be deployed to your AWS account

**6.** Connect to RDS cluster:

To proceed further, you will need to connect to the newly created RDS cluster using the [query editor](https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/query-editor.html) on the AWS console.
- Select the RDS cluster created in step 1 from the dropdown. It would be of the format `talent-board-backend-database-<stage>-aurorardscluster-<cluster name>`
- You can connect to the database using the Secrets Manager. You can get the ARN from the output of step 1 (`SecretARN`). By doing so, AWS will automatically fetch the DB username and password from the Secrets Manager and connect with the database
- Enter `TB` for the name of the database

![Connect to Database](https://i.ibb.co/cybcXLq/connect-to-database.png)

**6.** Navigate to *[Resources/DatabaseResources/createTable.sql](https://github.com/CodeOpsTechnologies/talent-board-be/blob/main/Resources/DatabaseResources/createTable.sql)* and paste the create table script into query editor

The table schema:
- `name` - VARCHAR(256) NOT NULL -  Name of the user adding the profile
- `skills` - JSON NOT NULL - A list of skills selected by the user
- `industry` - VARCHAR(256) NOT NULL - The industry the user belongs to
- `jobRole` - VARCHAR(256) NOT NULL - The user's current job role
- `proficiencyLevel` - VARCHAR(18) NOT NULL - The user's AWS proficiency level
- `visibilityDuration` - TINYINT(4) NOT NULL - The visibility duration until which the user wants their profile to be visible on the Talent Board page. The accepted values are `1 -> 15 days, 2 -> 30 days, 3 -> 45 days, 4 -> 60 days, 5 -> 90 days`
- `relocation` - TINYINT(1) NOT NULL DEFAULT `0` - A boolean flag to indicate if the user is willing to relocate
- `state` - VARCHAR(128) NOT NULL - User's state
- `city` - VARCHAR(128) NOT NULL - User's city
- `experience` - TINYINT(10) NOT NULL - User's experience in number of years. The accepted values are - `1 -> 0-1 year, 2 -> 1-3 years, 3 -> 4 - 7 years, 4 -> 8-10 years, 5 -> 11-15 years, 6 -> 16+ years`
- `linkedinUrl` - TEXT CHARACTER SET utf8 NOT NULL - User's LinkedIn URL
- `createdAt` - TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP - The UTC timestamp at which the profile was created
- `updatedAt` - TIMESTAMP NULL DEFAULT NULL ON UPDATE CURRENT_TIMESTAMP - The UTC timestamp at which the user's profile was updated
- `expireAfter` - DATE NOT NULL - The UTC date after which the profile should be marked as expired. This date is calculated based on the `visibilityDuration` provided by the user
- `profileStatus` - TINYINT(4) DEFAULT `1` - The status of the profile, 1 -> Active, 2 -> Expired 

## Contribution Guidelines
[![GitHub pull requests](https://img.shields.io/github/issues-pr-raw/CodeOpsTechnologies/talent-board-be?logo=git&logoColor=white)](https://github.com/CodeOpsTechnologies/talent-board-be/compare) 
[![GitHub contributors](https://img.shields.io/github/contributors/CodeOpsTechnologies/talent-board-be?logo=github)](https://github.com/CodeOpsTechnologies/talent-board-be/graphs/contributors) 
[![Author](https://img.shields.io/badge/Author-@CodeOpsTechnologies-gray.svg?colorA=gray&colorB=dodgerblue&logo=github)](https://github.com/CodeOpsTechnologies/)

- Write clear meaningful git commit messages (Do read [this](http://chris.beams.io/posts/git-commit/)).
- Make sure your PR's description contains GitHub's special keyword references that automatically close the related issue when the PR is merged. (Check [this](https://github.com/blog/1506-closing-issues-via-pull-requests) for more info)
- When you make very minor changes to a PR of yours (like for example fixing a typo in documentation, minor changes requested by reviewers) make sure you squash your commits afterward so that you don't have an absurd number of commits for a very small fix. (Learn how to squash at [here](https://davidwalsh.name/squash-commits-git))
- Always create PR to `main` branch.
- Please read our [Code of Conduct](./CODE_OF_CONDUCT.md).
- Refer [this](https://github.com/CodeOpsTechnologies/talent-board-fe/blob/master/CONTRIBUTING.md) for more.

## Other Useful Links

Frontend Code - [https://github.com/CodeOpsTechnologies/talent-board-fe](https://github.com/CodeOpsTechnologies/talent-board-fe)
<br>
Deployed URL - [https://talent.awsug.in/](https://talent.awsug.in/)
<br>
Backend Code - [https://github.com/CodeOpsTechnologies/talent-board-be](https://github.com/CodeOpsTechnologies/talent-board-be)
<br>
API Docs - [http://reskill-documentaion.s3-website-ap-southeast-1.amazonaws.com/#api-AWS_UG_Talent_Board](http://reskill-documentaion.s3-website-ap-southeast-1.amazonaws.com/#api-AWS_UG_Talent_Board)

***Glad to see you here! Show some love by [starring](https://github.com/CodeOpsTechnologies/talent-board-fe/) this repo.***

[![Facebook](https://img.shields.io/static/v1.svg?label=connect&message=@CodeOpsTech&color=grey&logo=facebook&style=flat&logoColor=white&colorA=royalblue)](https://www.facebook.com/CodeOpsTech)
[![LinkedIn](https://img.shields.io/static/v1.svg?label=connect&message=@CodeOpsTech&color=grey&logo=linkedin&style=flat&logoColor=white&colorA=royalblue)](https://www.linkedin.com/company/codeops-technologies/)
[![Twitter](https://img.shields.io/static/v1.svg?label=connect&message=@CodeOpsTech&color=grey&logo=twitter&style=flat&logoColor=white&colorA=royalblue)](https://twitter.com/CodeOpsTech)